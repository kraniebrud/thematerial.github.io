
<p class="geo-info" style="font-size: 33px;">
  ... looking
</p>

<script>

  const lookupByIP = () => fetch('https://ipapi.co/json')
    .then((response) => {
      return response.json()
    })
    .then((inJson) => {
      return inJson
    })

  const coordsFromIP = {longitude: 0, latitude: 0}
  setCoordsFromIP = () => {
    lookupByIP().then(res => {
      coordsFromIP.longitude = res.longitude
      coordsFromIP.latitude = res.latitude
    })
  }
  setCoordsFromIP()
  setInterval(setCoordsFromIP, 10000)

  const geoInfo = document.querySelector('.geo-info')

  const options = {
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 0
  }

  const handleLocationError = (error) => {
    switch (error.code) {
      case 3:
        console.log(' ...... default sjit ?', {coordsFromIP})
        displayLocationInfo({coords: {...coordsFromIP }}, true)

        // now let's make a non-cached request to get the actual position
        navigator.geolocation.getCurrentPosition(displayLocationInfo, handleLocationError)
        break;
      case 2:
        // ...
        break;
      case 1:
      // ...
    }
  }

  const displayLocationInfo = (position, fromIP = false) => {
    const lng = position.coords.longitude;
    const lat = position.coords.latitude;
    const time = new Date().toLocaleTimeString()
    geoInfo.innerHTML = `${fromIP ? 'IP' : 'GEO)'} <ul><li>longitude: ${lng}</li><li>latitude: ${lat}</li><li>time ${time}</li></ul>`
  }

  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(displayLocationInfo, handleLocationError, options)
    setTimeout(
      () => {
        navigator.geolocation.watchPosition(displayLocationInfo, handleLocationError. options)
      }, 1200
    )   
    // const watcher = navigator.geolocation.watchPosition(displayGeo)
    // navigator.geolocation.clearWatch(watcher)
  }
  else {
    geoInfo.innerHTML = `Awwwww :(`
    // setCoordsFromIp() --> timed
  }

</script>